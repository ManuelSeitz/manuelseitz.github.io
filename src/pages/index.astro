---
import Layout from "../layout/Layout.astro";
import commands from "../data/commands.json";
---

<Layout>
  <main class="grid min-h-screen place-items-center">
    <section
      class="terminal relative flex h-[75vh] w-4/5 flex-col rounded-xl bg-neutral-900 max-md:h-[90vh] max-md:w-[90%]"
    >
      <header
        class="flex items-center justify-between border-b-2 border-neutral-800 px-3 py-3"
      >
        <h1 class="sr-only">
          Manuel Seitz, Analista de Sistemas y Desarrollador Front-End
        </h1>
        <div
          class="flex items-center gap-2.5 rounded-3xl border border-neutral-700 px-3 py-2"
        >
          <div
            class="size-2 shrink-0 rounded-full bg-green-400 shadow-[0_0_10px_2px_rgba(34,197,94,0.4)]"
          >
          </div>
          <div class="mt-0.5 text-sm leading-3.5">Abierto a propuestas</div>
        </div>
      </header>
      <main id="content" class="font-code relative flex-1 overflow-y-auto p-6">
        <div
          id="overlay"
          class="h-52 opacity-0 transition-opacity duration-200"
        >
        </div>
        <ul id="command-list" class="list hidden">
          {
            commands.map((command) => (
              <li>
                <strong class="text-orange-300 lowercase">
                  {command.name}
                </strong>
                <span class="text-neutral-500">{command.description}</span>
              </li>
            ))
          }
        </ul>
        <br />
      </main>
      <div
        class="font-code flex items-center gap-2 border-t-2 border-neutral-700 p-6"
      >
        <span class="shrink-0 font-bold text-pink-300">~/manuel-seitz </span>
        <div class="relative flex basis-full items-center leading-4">
          <input
            type="text"
            id="input"
            class="z-20 inline-block w-full cursor-default caret-transparent outline-0"
          />
          <span id="info" class="absolute z-10 text-neutral-500 max-sm:hidden"
            >usa <strong class="text-neutral-400">help</strong> si necesitas ayuda</span
          >
          <div
            class="cursor pointer-events-none absolute top-0 left-0 inline-block h-4 w-2.5 bg-neutral-50"
          >
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>

<script>
  import { handleInput } from "../utils/events/input.ts";
  import { handleKeydown } from "../utils/events/keydown/keydown.ts";
  import { handleScroll } from "../utils/events/scroll.ts";
  import { writeInitialParagraphs } from "../utils/init.ts";

  const content = document.getElementById("content") as HTMLElement;

  const input = document.getElementById("input") as HTMLInputElement;
  input.disabled = true;

  content.addEventListener("scroll", handleScroll);

  input.addEventListener("input", handleInput);

  await writeInitialParagraphs();
  input.disabled = false;

  window.addEventListener("keydown", handleKeydown);

  const commandList = document.getElementById("command-list") as HTMLElement;
  commandList.classList.remove("hidden");
</script>

<style is:inline>
  @property --angle {
    syntax: "<angle>";
    initial-value: 0deg;
    inherits: false;
  }

  @property --color-angle {
    syntax: "<number>";
    initial-value: 0;
    inherits: true;
  }

  .terminal {
    animation: 10s rainbow linear infinite;
  }

  .terminal::before,
  .terminal::after {
    --border-size: 2px;
    content: "";
    position: absolute;
    width: calc(100% + var(--border-size));
    height: calc(100% + var(--border-size));
    top: 50%;
    left: 50%;
    translate: -50% -50%;
    background: conic-gradient(
      from var(--angle),
      transparent 90%,
      hsl(var(--color-angle), 70%, 65%)
    );
    animation: 6s border-spin linear infinite;
    border-radius: var(--radius-xl);
    z-index: -1;
  }

  .terminal::after {
    filter: blur(24px);
    opacity: 0.2;
  }

  @keyframes border-spin {
    from {
      --angle: 0deg;
    }
    to {
      --angle: 360deg;
    }
  }

  #overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      0deg,
      transparent 20%,
      var(--color-neutral-900)
    );
    pointer-events: none;
  }

  .list strong {
    font-weight: bold;
    color: hsl(var(--color-angle), 70%, 65%);
  }

  .list li::before {
    content: "- ";
  }

  .list li.selected::before {
    content: "> ";
  }

  .list li.selected {
    color: hsl(var(--color-angle), 70%, 75%);
  }

  @keyframes rainbow {
    from {
      --color-angle: 0;
    }
    to {
      --color-angle: 360;
    }
  }

  .cursor {
    animation: 1s blink steps(1, end) infinite;
  }

  @keyframes blink {
    0% {
      opacity: 1;
    }
    50% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }
</style>
